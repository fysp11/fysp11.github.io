---
import NavBar from '@/components/layouts/navbar.astro';
import Footer from '@/components/layouts/footer.astro';
import '@/styles/globals.css';
import Container from '@/components/ui/Container.astro';
import QueryProvider from '@/components/QueryProvider';
import Analytics from '@/components/Analytics.astro';
import { getProfile } from '@/server/data';

interface Props {
  title?: string;
  description?: string;
}

const { personal } = await getProfile();

const { title = personal.name, description = personal.subtitle } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width" />
    <script is:inline>
      // Set initial theme ASAP based on localStorage or system preference to avoid FOUC
      (function () {
        try {
          const stored = localStorage.getItem('theme');
          const prefersDark =
            window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          const useDark = stored ? stored === 'dark' : prefersDark;
          const root = document.documentElement;
          if (useDark) {
            root.classList.add('dark');
          } else {
            root.classList.remove('dark');
          }
        } catch (e) {
          // no-op
        }
      })();
    </script>
    <link rel="icon" href="/icons/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body>
    <QueryProvider client:only="react">
      <NavBar />
      <Container class="w-full px-[14px] sm:max-w-xl md:max-w-2xl">
        <slot />
      </Container>
      <Footer />
    </QueryProvider>

    <Analytics />
  </body>
</html>
